<div class="register-container">
  <mat-card class="register-card">
    <mat-card-header>
      <mat-card-title>Crear una Cuenta</mat-card-title>
    </mat-card-header>

    <mat-card-content>

      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

        <mat-stepper [linear]="true" #stepper>
          <!--
            PASO 1: Datos Personales
          -->
          <mat-step [stepControl]="registerForm.get('step1')!">
            <ng-template matStepLabel>Datos Personales</ng-template>
            <div [formGroupName]="'step1'" class="step-container">
              <mat-form-field appearance="outline">
                <mat-label>Nombre/s</mat-label>
                <input matInput placeholder="Ej. Ana" formControlName="nombre">
                <mat-icon matSuffix>person</mat-icon>
                <mat-error *ngIf="getControl('step1', 'nombre')?.hasError('required')">El nombre es
                  requerido</mat-error>
                <mat-error *ngIf="getControl('step1', 'nombre')?.hasError('pattern')">Solo debe contener
                  letras</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Apellido Paterno</mat-label>
                <input matInput placeholder="Ej. Pérez" formControlName="ap">
                <mat-error *ngIf="getControl('step1', 'ap')?.hasError('required')">El apellido es requerido</mat-error>
                <mat-error *ngIf="getControl('step1', 'ap')?.hasError('pattern')">Solo debe contener letras</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Apellido Materno</mat-label>
                <input matInput placeholder="Ej. García" formControlName="am">
                <mat-error *ngIf="getControl('step1', 'am')?.hasError('required')">El apellido es requerido</mat-error>
                <mat-error *ngIf="getControl('step1', 'am')?.hasError('pattern')">Solo debe contener letras</mat-error>
              </mat-form-field>
              <div class="step-actions">
                <button mat-raised-button color="primary" matStepperNext type="button"
                  (click)="validateStep('step1', stepper)">
                  Siguiente </button>
              </div>
            </div>
          </mat-step>
          <!--
            PASO 2: Datos de la Cuenta
          -->
          <mat-step [stepControl]="registerForm.get('step2')!">
            <ng-template matStepLabel>Datos de la Cuenta</ng-template>
            <div [formGroupName]="'step2'" class="step-container">

              <mat-form-field appearance="outline">
                <mat-label>Nombre de Usuario</mat-label>
                <input matInput formControlName="username">
                <mat-icon matSuffix>account_circle</mat-icon>
                <mat-error *ngIf="getControl('step2', 'username')?.hasError('required')">El usuario es
                  requerido</mat-error>
                <mat-error *ngIf="getControl('step2', 'username')?.hasError('pattern')">Solo letras y
                  números</mat-error>
                <mat-error *ngIf="getControl('step2', 'username')?.hasError('usernameTaken')">El nombre de usuario ya
                  está en uso</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Email</mat-label>
                <input matInput type="email" placeholder="ejemplo@correo.com" formControlName="email">
                <mat-icon matSuffix>email</mat-icon>
                <mat-error *ngIf="getControl('step2', 'email')?.hasError('required')">El email es requerido</mat-error>
                <mat-error *ngIf="getControl('step2', 'email')?.hasError('email')">Email no válido</mat-error>
                <mat-error *ngIf="getControl('step2', 'email')?.hasError('emailTaken')">El email ya está en
                  uso</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Contraseña</mat-label>
                <input matInput [type]="showPassword ? 'text' : 'password'" formControlName="password">
                <button mat-icon-button matSuffix (click)="togglePasswordVisibility()" type="button">
                  <mat-icon>{{showPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>
                <mat-error *ngIf="getControl('step2', 'password')?.hasError('required')">La contraseña es
                  requerida</mat-error>
                <mat-error *ngIf="getControl('step2', 'password')?.hasError('pattern')">Debe tener 12+ caracteres, 1
                  mayúscula, 1 número y 1 símbolo.</mat-error>
                <mat-error *ngIf="registerForm.get('step2')?.hasError('passwordsDoNotMatch')">Las contraseñas no
                  coinciden</mat-error>
                <mat-error *ngIf="getControl('step2', 'password')?.hasError('sequentialNumbers')">La contraseña no puede
                  contener secuencias numéricas obvias.</mat-error>
                <mat-error *ngIf="getControl('step2', 'password')?.hasError('containsPersonalData')">La contraseña no
                  puede contener tus datos personales.</mat-error>
                <mat-error *ngIf="getControl('step2', 'password')?.hasError('containsCommonPassword')">La contraseña no
                  puede ser una contraseña común.</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Confirmar Contraseña</mat-label>
                <input matInput [type]="showPassword ? 'text' : 'password'" formControlName="confirmPassword">
                <mat-error *ngIf="getControl('step2', 'confirmPassword')?.hasError('required')">La confirmación es
                  requerida</mat-error>
                <mat-error *ngIf="registerForm.get('step2')?.hasError('passwordsDoNotMatch')">Las contraseñas no
                  coinciden</mat-error>
              </mat-form-field>
              <div class="step-actions">
                <button mat-button matStepperPrevious type="button">Atrás</button>
                <button mat-raised-button color="primary" type="button" (click)="validateStep('step2', stepper)">
                  Siguiente </button>
              </div>
            </div>
          </mat-step>
          <!--
            PASO 3: Seguridad y Términos
          -->
          <mat-step [stepControl]="registerForm.get('step3')!">
            <ng-template matStepLabel>Seguridad</ng-template>
            <div [formGroupName]="'step3'" class="step-container">

              <mat-form-field appearance="outline">
                <mat-label>Teléfono</mat-label>
                <input matInput type="tel" placeholder="10 dígitos" formControlName="telefono">
                <mat-icon matSuffix>phone</mat-icon>
                <mat-error *ngIf="getControl('step3', 'telefono')?.hasError('required')">El teléfono es
                  requerido</mat-error>
                <mat-error *ngIf="getControl('step3', 'telefono')?.hasError('pattern')">Debe tener 10
                  dígitos</mat-error>
                <mat-error *ngIf="getControl('step3', 'telefono')?.hasError('phoneTaken')">El teléfono ya está en
                  uso</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Pregunta Secreta</mat-label>
                <mat-select formControlName="preguntaSecreta">
                  <mat-option value="">Selecciona una pregunta</mat-option>
                  <mat-option value="personaje-favorito">¿Cuál es tu personaje favorito?</mat-option>
                  <mat-option value="pelicula-favorita">¿Cuál es tu película favorita?</mat-option>
                  <mat-option value="mejor-amigo">¿Quién es tu mejor amigo?</mat-option>
                  <mat-option value="nombre-mascota">¿Cuál es el nombre de tu mascota?</mat-option>
                  <mat-option value="deporte-favorito">¿Cuál es tu deporte favorito?</mat-option>
                </mat-select>
                <mat-error *ngIf="getControl('step3', 'preguntaSecreta')?.hasError('required')">Selecciona una
                  pregunta</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Respuesta Secreta</mat-label>
                <input matInput formControlName="respuestaSecreta">
                <mat-icon matSuffix>forum</mat-icon>
                <mat-error *ngIf="getControl('step3', 'respuestaSecreta')?.hasError('required')">La respuesta es
                  requerida</mat-error>
                <mat-error *ngIf="getControl('step3', 'respuestaSecreta')?.hasError('pattern')">Solo debe contener
                  letras</mat-error>
              </mat-form-field>

              <mat-checkbox formControlName="terminos" class="terms-checkbox">
                <span>
                  Acepto los <a routerLink="/terminos" target="_blank">Términos y Condiciones</a>
                  y he leído el <a routerLink="/privacidad" target="_blank">Aviso de Privacidad</a>
                </span>
              </mat-checkbox>
              <mat-error class="terms-error"
                *ngIf="getControl('step3', 'terminos')?.hasError('requiredTrue') && getControl('step3', 'terminos')?.touched">
                Debes aceptar los términos
              </mat-error>
              <div class="step-actions">
                <button mat-button matStepperPrevious type="button">Atrás</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="!registerForm.valid">
                  Registrarse
                </button>
              </div>
            </div>
          </mat-step>
        </mat-stepper>

      </form>
    </mat-card-content>

    <mat-card-footer class="login-link">
      <p>¿Ya tienes una cuenta? <a routerLink="/login">Inicia Sesión</a></p>
    </mat-card-footer>
  </mat-card>
</div>